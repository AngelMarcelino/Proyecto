<?php

include ("sidebar-user.html");
include ("getArticles.php");
?>
    <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
        <h2 class="placeholder">Articulos</h2>
        <div class="row">
            <label class = "col-md-2" for="">Categoria<?php echo $categoria ?></label>
            <div class="col-md-4">
                <select id="select-categoria" name="IdCategoria" required class="form-control">
                    <option value = "0">Todas...</option>
                    <?php
                        for($a = 0; $a < count($categorias); $a ++)
                        {
                            $cat = $categorias[$a];
                            echo '<option value="' . $cat["Id"] . '">' . $cat["Nombre"] . '</option>';
                        }
                    ?>
                </select>
            </div>
            <div class="col-md 2">
                <button onclick="filtrar()" class="btn btn-default">Filtrar</button>
            </div>
        </div>
        <table class="table table-bordered top-row">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Descripci&oacute;n</th>
                    <th>Categoria</th>
                    <th>Precio de venta</th>
                    <th>Cantidad</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <?php
                    for($u = 0; $u < count($articulos); $u++)
                    {
                        $articulo = $articulos[$u];
                        echo '<tr>'.
                        '<td>'.$articulo["Nombre"] . '</td>'.
                        '<td>'.$articulo["Descripcion"] . '</td>'.
                        '<td>'.$articulo["Categoria"] . '</td>'.
                        '<td>'.$articulo["PrecioVenta"] . '</td>'.
                        '<td>'.$articulo["Cantidad"] . '</td>'.
                        '<td><a class="btn btn-default" href="'.urlParams("Articles/editarArticulo.php", array("articulo" => $articulo["Id"]))
                        .
                        '"><span class="glyphicon glyphicon-pencil"></span></a>'.
                        '<a class="btn btn-danger" onclick="deleteArticle(event)" data-articulo="'. $articulo['Id']. '"><span class="glyphicon glyphicon-trash"></a></tr>'.

                        '<tr>';
                    }
                    
                ?>
            </tbody>
        </table>
        <script>

                function deleteArticle(event)
                {
                    var Id  = event.srcElement.dataset["articulo"];
                    console.log(event.srcElement);
                    if(confirm("Seguro que deseas eliminar")){
                        window.location =getUrl() + "/usuarios/Articles/deleteArticle.php?articulo=" + Id;
                    }
                }

                $("#search").on("keyup", function(e)
                {
                    var tds = $("td:first-child");
                    console.log(tds);
                    tds.each(function(i)
                    {
                        if(e.target.value == "")
                        {
                            $(this).parent().fadeIn();
                        }
                        else{
                            if($(this).html().toLowerCase().includes(e.target.value.toLowerCase())
                            || $(this).next().html().toLowerCase().includes(e.target.value.toLowerCase()))
                            {
                                $(this).parent().fadeIn();
                            }
                            else
                            {
                                $(this).parent().fadeOut();
                                
                            } 
                        }
                        
                    });
                    
                }).prop("disabled", false);
                function filtrar()
                {
                    var value = $("#select-categoria").val();
                    if(value != 0)
                        window.location = getUrl()+"/usuarios/index.php?pagina=Articles/articulos.html&categoria=" + value;
                        else{
                            window.location =getUrl() + "/usuarios/index.php?pagina=Articles/articulos.html";
                            
                        }
                }
        </script>
    </div>